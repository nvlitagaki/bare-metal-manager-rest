/*
 * SPDX-FileCopyrightText: Copyright (c) 2026 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
 * SPDX-License-Identifier: Apache-2.0
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

syntax = "proto3";

package measured_boot;

import "google/protobuf/duration.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

////////////////////////////////////////////////////////////////////////////////
// RPC messages for Bundles
////////////////////////////////////////////////////////////////////////////////

// CreateMeasurementBundleRequest is used to create a new measurement bundle
// with provided pcr_index:value measurements.
//
// profile_id: This maps to a MeasurementSystemProfileId, and is the system
//             profile this bundle is associated with.
//
// name:       This is an optional name to give the bundle. If none is
//             provided, one will be automatically generated for you.
//
// pcr_values: These are the PCR values to associate with the bundle, which
//             contains the register index and corresponding sha_any for
//             the register.
//
// state:      This is the state of the bundle. If unset, it will default
//             to Active, but allows for the flexibility of creating a
//             bundle that is Obsolete, Retired, or Revoked.

message CreateMeasurementBundleRequest {
  MeasurementSystemProfileId profile_id = 1;
  optional string name = 2;
  repeated PcrRegisterValuePb pcr_values = 3;
  MeasurementBundleStatePb state = 4;
}

// CreateMeasurementBundleResponse contains the resulting
// MeasurementBundle inserted into the database.
//
// bundle:     The resulting MeasurementBundle inserted into
//             the database, represented as a MeasurementBundlePb
//             for the purpose of transit.

message CreateMeasurementBundleResponse {
  MeasurementBundlePb bundle = 1;
}

// DeleteMeasurementBundleRequest allows a caller to delete a
// measurement bundle based on the bundle ID or name, providing
// a selector to do so.
//
// selector: The selector to delete by, where:
//      bundle_id:   The MeasurementBundleId to use.
//      bundle_name: The measurement bundle name to use.

message DeleteMeasurementBundleRequest {
  oneof selector {
    MeasurementBundleId bundle_id = 1;
    string bundle_name = 2;
  }
}

// DeleteMeasurementBundleResponse contains the complete
// measurement bundle that was deleted.
//
// bundle: The resulting MeasurementBundle that was deleted
//         from the database.

message DeleteMeasurementBundleResponse {
  MeasurementBundlePb bundle = 1;
}

// RenameMeasurementBundleRequest renames a bundle.
//
// selector: The selector to delete by, where:
//      bundle_id:   The MeasurementBundleId to use.
//      bundle_name: The measurement bundle name to use.

message RenameMeasurementBundleRequest {
  oneof selector {
    MeasurementBundleId bundle_id = 1;
    string bundle_name = 2;
  }
  string new_bundle_name = 3;
}

// RenameMeasurementBundleResponse is the result
// of renaming a measurement bundle, which, if successful,
// should return a MeasurementBundle with the new name.

// bundle: The resulting MeasurementBundle that was renamed
//         in the database.

message RenameMeasurementBundleResponse {
  MeasurementBundlePb bundle = 1;
}

// UpdateMeasurementBundleRequest updates the state of a MeasurementBundle
// based on its bundle ID or name, allowing the caller to make an Active
// bundle Obsolete (or vice versa), or Retired (or vice versa). Revoked
// bundles cannot be changed once Revoked.
//
// selector: The selector to update by, where:
//      bundle_id:   The MeasurementBundleId to use.
//      bundle_name: The measurement bundle name to use.
//
// state:    The new bundle state to set (Active, Obsolete, Retired,
//           Revoked).

message UpdateMeasurementBundleRequest {
  oneof selector {
    MeasurementBundleId bundle_id = 1;
    string bundle_name = 2;
  }
  MeasurementBundleStatePb state = 3;
}

// DeleteMeasurementBundleResponse contains the complete
// measurement bundle that was updated.
//
// bundle: The resulting MeasurementBundle that was updated
//         in the database.

message UpdateMeasurementBundleResponse {
  MeasurementBundlePb bundle = 1;
}

// ShowMeasurementBundleRequest lets you show full info about about
// a bundle by its ID or name.
//
// selector: The selector to show by, where:
//      bundle_id:   The MeasurementBundleId to use.
//      bundle_name: The measurement bundle name to use.
//

message ShowMeasurementBundleRequest {
  oneof selector {
    MeasurementBundleId bundle_id = 1;
    string bundle_name = 2;
  }
}

// ShowMeasurementBundleResponse contains the complete
// measurement bundle.
//
// bundle: The resulting MeasurementBundle that was pulled
//         from the database.

message ShowMeasurementBundleResponse {
  MeasurementBundlePb bundle = 1;
}

// ShowMeasurementBundlesRequest gets + displays all info
// about all bundles in the database.

message ShowMeasurementBundlesRequest {
}

// ShowMeasurementBundlesResponse contains all complete
// measurement bundles and their details.
//
// bundles: All of the complete MeasurementBundle instances.

message ShowMeasurementBundlesResponse {
  repeated MeasurementBundlePb bundles = 1;
}

// ListMeasurementBundlesRequest is for getting high
// level info about all bundles, where behind the scenes,
// only the bundle records are queried (instead of both
// records and values).

message ListMeasurementBundlesRequest {
}

// ListMeasurementBundlesResponse is the list of all
// bundle records (not full bundles + values).
//
// bundles: All available MeasurementBundleRecords.

message ListMeasurementBundlesResponse {
  repeated MeasurementBundleRecordPb bundles = 1;
}

// ListMeasurementBundleMachinesRequest allows a caller to list
// all machines currently associated with the given bundle,
// for a provided bundle ID or bundle name.
//
// selector: The selector to list by, where:
//      bundle_id:   The MeasurementBundleId to use.
//      bundle_name: The measurement bundle name to use.
//

message ListMeasurementBundleMachinesRequest {
  oneof selector {
    MeasurementBundleId bundle_id = 1;
    string bundle_name = 2;
  }
}

// ListMeasurementBundleMachinesResponse returns all of the
// machines currently associated with a given bundle.
//
// machine_ids: The list of machine IDs.

message ListMeasurementBundleMachinesResponse {
  repeated string machine_ids = 1;
}

message FindClosestBundleMatchRequest{
  MeasurementReportId report_id = 1;
}

////////////////////////////////////////////////////////////////////////////////
// RPC messages for Journals
////////////////////////////////////////////////////////////////////////////////

// DeleteMeasurementJournalRequest is used to delete a
// journal entry.
//
// journal_id: The journal ID to delete.

message DeleteMeasurementJournalRequest {
  MeasurementJournalId journal_id = 1;
}

// DeleteMeasurementJournalResponse is returned upon a
// successful deletion of a journal entry.
//
// journal: The complete MeasurementJournal that was deleted
//          from the database.

message DeleteMeasurementJournalResponse {
  MeasurementJournalPb journal = 1;
}

// ShowMeasurementJournalRequest is used to pull down a
// complete MeasurementJournal model.
//
// selector: The selector to show by, where:
//      journal_id: The journal ID to use for selecting.

message ShowMeasurementJournalRequest {
  oneof selector {
    MeasurementJournalId journal_id = 1;
    string latest_for_machine_id = 2;
  }
}

// ShowMeasurementJournalResponse contains the
// journal being queried.
//
// journal: The complete MeasurementJournal in the database.

message ShowMeasurementJournalResponse {
  MeasurementJournalPb journal = 1;
}

// ShowMeasurementJournalsRequest is used to get full
// details about all journals.

message ShowMeasurementJournalsRequest {
}

// ShowMeasurementJournalsResponse contains all complete
// MeasurementJournal instances from the system.
//
// journals: A list of all MeasurementJournal models.

message ShowMeasurementJournalsResponse {
  repeated MeasurementJournalPb journals = 1;
}

// ListMeasurementJournalRequest lists all high level
// details about all journals, with the ability to limit
// the list by all entries for a given machine ID.
//
// selector: Sub-select what is returned, where
//      machine_id: Only lists journals for the given machine ID.

message ListMeasurementJournalRequest {
  oneof selector {
    string machine_id = 1; 
  }
}

// ListMeasurementJournalResponse returns high-level details
// for all matching journals from the list call.
//
// journals: A list of MeasurementJournalRecord instances.

message ListMeasurementJournalResponse {
  repeated MeasurementJournalRecordPb journals = 1;
}

////////////////////////////////////////////////////////////////////////////////
// RPC messages for Mock Machines
////////////////////////////////////////////////////////////////////////////////

// AttestCandidateMachineRequest is used to mock an attestation flow
// for a mock machine, sending the PCR values to attest.
//
// machine_id: The machine ID to attest.
// pcr_values: The list of PCR values (which is the register
//             index + sha_any value).

message AttestCandidateMachineRequest {
  string machine_id = 1;
  repeated PcrRegisterValuePb pcr_values = 2;
}

// AttestCandidateMachineResponse returns the measurement report
// created for the attestation attempt.
//
// report: A populated MeasurementReport, containing its
//         info + received values.

message AttestCandidateMachineResponse {
  MeasurementReportPb report = 1;
}

// ShowCandidateMachineRequest is used to show info about a
// mock machine.
//
// selector: The selector to show by, where:
//      machine_id: The machine ID to use.

message ShowCandidateMachineRequest {
  oneof selector {
    string machine_id = 1;
  }
}

// ShowCandidateMachineResponse returns the selected CandidateMachine.
//
// machine: The fully-populated CandidateMachine instance (info
//          + attrs) from the database.

message ShowCandidateMachineResponse {
  CandidateMachinePb machine = 1;
}

// ShowCandidateMachinesRequest shows all info about all
// mock machines.

message ShowCandidateMachinesRequest {
}

// ShowCandidateMachinesResponse returns all populated
// mock machine models from the database, which includes
// their info + attributes.
//
// machines: The list of CandidateMachine models.

message ShowCandidateMachinesResponse {
  repeated CandidateMachinePb machines = 1;
}

// ListCandidateMachinesRequest lists all high-level details about
// mock machines, without their full attributes.

message ListCandidateMachinesRequest {
}

// ListCandidateMachinesResponse returns all high-level details about
// mock machines.
//
// machines: The list of CandidateMachineRecords.

message ListCandidateMachinesResponse {
  repeated CandidateMachineSummaryPb machines = 1;
}

////////////////////////////////////////////////////////////////////////////////
// RPC messages for Reports
////////////////////////////////////////////////////////////////////////////////

// CreateMeasurementReportRequest is used to create a new
// measurement report outside of the usual attestation flow.
//
// machine_id: The machine ID to make a report for.
// pcr_values: The PCR values to associate with the report.

message CreateMeasurementReportRequest {
  string machine_id = 1;
  repeated PcrRegisterValuePb pcr_values = 2;
}

// CreateMeasurementReportResponse returns the fully populated
// report that was added to the database.
//
// report: The full MeasurementReport model stored in the
//         database.

message CreateMeasurementReportResponse {
  MeasurementReportPb report = 1;
}

// DeleteMeasurementReportRequest is used to delete a
// measurement report from the database.
//
// report_id: The report to delete.

message DeleteMeasurementReportRequest {
  MeasurementReportId report_id = 1;
}

// DeleteMeasurementReportResponse is returned
// upon a successful call to delete a report.
//
// report: The full MeasurementReport model deleted
//         from the database.

message DeleteMeasurementReportResponse {
  MeasurementReportPb report = 1;
}

// PromoteMeasurementReportRequest is used to promote a given
// measurement report into a shiny new measurement bundle! This
// allows the caller to select which specific PCR register
// indexes to select from the report.
//
// report_id: The report to promote.
// pcr_registers: An optional list of PCR register indexes to
//                select, which is a comma-separated list of
//                numbers and/or X-Y combinations. For example,
//                0,1,3-5 will result in 0,1,3,4,5.

message PromoteMeasurementReportRequest {
  MeasurementReportId report_id = 1;
  string pcr_registers = 2;
}

// PromoteMeasurementReportResponse is returned upon the
// successful promotion of a report.
//
// bundle: The resulting "active" MeasurementBundle model.

message PromoteMeasurementReportResponse {
  MeasurementBundlePb bundle = 1;
}

// RevokeMeasurementReportRequest is used to promote a given
// measurement report into a shiny new "REVOKED" measurement
// bundle! This allows the caller to select which specific PCR
// register indexes to select from the report.
//
// report_id: The report to promote as revoked.
// pcr_registers: An optional list of PCR register indexes to
//                select, which is a comma-separated list of
//                numbers and/or X-Y combinations. For example,
//   

message RevokeMeasurementReportRequest {
  MeasurementReportId report_id = 1;
  string pcr_registers = 2;
}

// RevokeMeasurementReportResponse is returned upon the
// successful promotion of a report to a revoked bundle.
//
// bundle: The resulting "revoked" MeasurementBundle model.

message RevokeMeasurementReportResponse {
  MeasurementBundlePb bundle = 1;
}

// ShowMeasurementReportForIdRequest is used to show all details
// about a measurement report.
//
// report_id: The report ID.

message ShowMeasurementReportForIdRequest {
  MeasurementReportId report_id = 1;
}

// ShowMeasurementReportForIdResponse returns the selected report.
//
// report: The fully populated MeasurementReport model.

message ShowMeasurementReportForIdResponse {
  MeasurementReportPb report = 1;
}

// ShowMeasurementReportsForMachineRequest is used to show all reports
// for a given machine.
//
// machine_id: The machine to get reports for.

message ShowMeasurementReportsForMachineRequest {
  string machine_id = 1;
}

// ShowMeasurementReportsForMachineResponse returns the machine reports.
//
// reports: Fully populated MeasurementReport models for
//          the requested machine.

message ShowMeasurementReportsForMachineResponse {
  repeated MeasurementReportPb reports = 1;
}

// ShowMeasurementReportsRequest is used to get all report
// models from the system.

message ShowMeasurementReportsRequest {
}

// ShowMeasurementReportsResponse returns all report models
// stored in the system.
//
// reports: The list of MeasurementReport models.

message ShowMeasurementReportsResponse {
  repeated MeasurementReportPb reports = 1;
}

// ListMeasurementReportRequest lists all high level report
// info (without values), with the ability to limit to all
// reports for a given machine ID.
//
// selector: Sub-select what is returned, where:
//      machine_id: Just return report details for a given machine.

message ListMeasurementReportRequest {
  oneof selector {
    string machine_id = 1; 
  }
}

// ListMeasurementReportResponse returns selected reports.
//
// reports: The MeasurementReportRecord instances (without values).

message ListMeasurementReportResponse {
  repeated MeasurementReportRecordPb reports = 1;
}

// MatchMeasurementReportRequest is used to find all reports
// matching the provided PCR values (where the PCR value is
// the register index + sha_any value).

message MatchMeasurementReportRequest {
  repeated PcrRegisterValuePb pcr_values = 1;
}

// MatchMeasurementReportResponse returns the MeasurementReport
// instances that matched the input pcr_values from the request.
//
// reports: The list of fully populated MeasurementReport models.

message MatchMeasurementReportResponse {
  repeated MeasurementReportRecordPb reports = 1;
}

////////////////////////////////////////////////////////////////////////////////
// RPC messages for Profiles
////////////////////////////////////////////////////////////////////////////////

// CreateMeasurementSystemProfileRequest is used to create
// a new system profile, duh.
//
// name:        An optional profile name. If not set, one will be
//              automatically generated.
// vendor:      The hardware vendor (e.g. dell) for the system profile.
//              Ultimately this just gets bundled together with "attrs",
//              but we enforce vendor + product as a baseline.
// product:     Similar to vendor, we do the same for product
//              (e.g. poweredge_r750).
// extra_attrs: Extra k/v attributes to set for the system profile,
//              where you may want things like uefi_version, tpm_version,
//              and others.

message CreateMeasurementSystemProfileRequest {
  optional string name = 1;
  string vendor = 2;
  string product = 3;
  repeated KvPair extra_attrs = 4;
}

// CreateMeasurementSystemProfileResponse is returned upon the
// successful completion of a new system profile creation.
//
// system_profile: The fully populated MeasurementSystemProfile
//                 model from the database.

message CreateMeasurementSystemProfileResponse {
  MeasurementSystemProfilePb system_profile = 1;
}

// DeleteMeasurementSystemProfileRequest is used to delete a
// system profile, either by the profile ID or name.
//
// selector: Used to select which profile to delete, where:
//      profile_id: The profile ID to use.
//      profile_name: The profile name to use.

message DeleteMeasurementSystemProfileRequest {
  oneof selector {
    MeasurementSystemProfileId profile_id = 1;
    string profile_name = 2;
  }
}

// DeleteMeasurementSystemProfileResponse is returned upon the
// successful deletion of a system profile.
//
// system_profile: The fully populated MeasurementSystemProfile
//                 model that was deleted from the database.

message DeleteMeasurementSystemProfileResponse {
  MeasurementSystemProfilePb system_profile = 1;
}

// RenameMeasurementSystemProfileRequest renames a profile.
//
// selector: The selector to delete by, where:
//      profile_id:   The MeasurementSystemProfileId to use.
//      profile_name: The measurement profile name to use.

message RenameMeasurementSystemProfileRequest {
  oneof selector {
    MeasurementSystemProfileId profile_id = 1;
    string profile_name = 2;
  }
  string new_profile_name = 3;
}

// RenameMeasurementSystemProfileResponse is the result
// of renaming a measurement profile, which, if successful,
// should return a MeasurementSystemProfile with the new name.

// profile: The resulting MeasurementSystemProfile that was renamed
//          in the database.

message RenameMeasurementSystemProfileResponse {
  MeasurementSystemProfilePb profile = 1;
}

// ShowMeasurementSystemProfileRequest shows all info about
// a system profile, including its general info as well as
// the profile attributes.
//
// selector: Used to select which profile to show, where:
//      profile_id: The profile ID to use.
//      profile_name: The profile name to use.

message ShowMeasurementSystemProfileRequest {
  oneof selector {
    MeasurementSystemProfileId profile_id = 1;
    string profile_name = 2;
  }
}

// ShowMeasurementSystemProfileResponse returns a complete
// MeasurementSystemProfile model.
//
// system_profile: The completely populated MeasurementSystemProfile
//                 model from the info + attrs tables in the database.

message ShowMeasurementSystemProfileResponse {
  MeasurementSystemProfilePb system_profile = 1;
}

// ShowMeasurementSystemProfilesRequest is used to get
// back a list of all MeasurementSystemProfile models
// stored in the database.

message ShowMeasurementSystemProfilesRequest {
}

// ShowMeasurementSystemProfilesResponse returns all system profile
// models from the database.
//
// system_profiles: A list of all MeasurementSystemProfile models
// stored in the database.

message ShowMeasurementSystemProfilesResponse {
  repeated MeasurementSystemProfilePb system_profiles = 1;
}

// ListMeasurementSystemProfilesRequest returns high-level info
// about system profiles (without attributes).

message ListMeasurementSystemProfilesRequest {
}

// ListMeasurementSystemProfilesResponse contains the high-level
// profile records.
//
// system_profiles: A list of populated MeasurementSystemProfileRecord
//                  instances, without attributes.

message ListMeasurementSystemProfilesResponse {
  repeated MeasurementSystemProfileRecordPb system_profiles = 1;
}

// ListMeasurementSystemProfileBundlesRequest is used to
// get a list of all bundle IDs that are currently mapped
// to a given profile, by profile ID or profile name.
//
// selector: Select how you want to query the profile, where:
//      profile_id: Select by profile ID.
//      profile_name: Select by profile name.

message ListMeasurementSystemProfileBundlesRequest {
  oneof selector {
    MeasurementSystemProfileId profile_id = 1;
    string profile_name = 2;
  }
}

// ListMeasurementSystemProfileBundlesResponse returns a list of
// all measurement bundle IDs associated with the selected profile.
//
// bundle_ids: A list of MeasurementBundleIds.

message ListMeasurementSystemProfileBundlesResponse {
  repeated MeasurementBundleId bundle_ids = 1;
}

// ListMeasurementSystemProfileMachinesRequest is used to
// get a list of all machine IDs that are currently mapped
// to a given profile, by profile ID or profile name.
//
// selector: Select how you want to query the profile, where:
//      profile_id: Select by profile ID.
//   

message ListMeasurementSystemProfileMachinesRequest {
  oneof selector {
    MeasurementSystemProfileId profile_id = 1;
    string profile_name = 2;
  }
}

// ListMeasurementSystemProfileMachinesResponse returns a list of
// all machine IDs associated with the selected profile.
//
// machine_ids: A list of CandidateMachineId (represented as strings).

message ListMeasurementSystemProfileMachinesResponse {
  repeated string machine_ids = 1;
}

////////////////////////////////////////////////////////////////////////////////
// RPC messages for Site Measurement Management
////////////////////////////////////////////////////////////////////////////////

// ImportSiteMeasurementsRequest imports a site model, where a site
// model contains bundles (info + values) and profiles (info + attributes).

message ImportSiteMeasurementsRequest {
  SiteModelPb model = 1;
}

// ImportSiteMeasurementsResponse returns if the import was successful
// or not.
//
// result: Was the import success or fail?

message ImportSiteMeasurementsResponse {
  ImportSiteResult result = 1;
}

// ExportSiteMeasurementsRequest is used to dump a SiteModel
// for the current site.

message ExportSiteMeasurementsRequest {

}

// ExportSiteMeasurementsResponse contains a SiteModel for
// the current site, which contains all system profile and
// bundle data.

message ExportSiteMeasurementsResponse {
  SiteModelPb model = 1;
}

// AddMeasurementTrustedMachineRequest is used to add a
// trusted machine for the site, where a trusted machine
// means the next report provided that machine will be
// automatically promoted to a measurement bundle (with
// the option to select which registers you want to use).
//
// machine_id:    The machine ID to trust.
// approval_type: The type of approval (oneshot or persist),
//                where oneshot is only used once, and persist
//                will be such that every report the machine
//                sends will convert into a bundle (if it doesn't
//                exist yet).
// pcr_registers: The specific PCR registers to pull from the
//                report and into the new bundle. Optional.
// comments:      Optional comments for the approval.

message AddMeasurementTrustedMachineRequest {
  string machine_id = 1;
  MeasurementApprovedTypePb approval_type = 2;
  string pcr_registers = 3;
  string comments = 4;
}

// AddMeasurementTrustedMachineResponse is returned upon a
// new trusted machine being added.
//
// approval_record: Info about the approval record in
//                  the database.

message AddMeasurementTrustedMachineResponse {
  MeasurementApprovedMachineRecordPb approval_record = 1;
}

// RemoveMeasurementTrustedMachineRequest is used to remove
// a trusted machine approval from the database.
//
// selector: Selects how to remove the approval record, where,
//      approval_id: Remove by approval ID.
//      machine_id: Remove by machine ID.

message RemoveMeasurementTrustedMachineRequest {
  oneof selector {
    MeasurementApprovedMachineId approval_id = 1;
    string machine_id = 2;
  }
}

// RemoveMeasurementTrustedMachineResponse is returned upon the
// successful deletion of a trusted machine approval.
//
// approval_record: The full approval record that was deleted.

message RemoveMeasurementTrustedMachineResponse {
  MeasurementApprovedMachineRecordPb approval_record = 1;
}

// AddMeasurementTrustedProfileRequest is used to add a
// trusted profile for the site, where a trusted profile
// means the next report provided by ANY machine matching
// the profile will be automatically promoted to a measurement
// bundle (with the option to select which registers you want
// to use from the report).
//
// profile_id:    The profile ID to trust.
// approval_type: The type of approval (oneshot or persist),
//                where oneshot is only used once, and persist
//                will be such that every report a machine matching
//                the profile sends will convert into a bundle (if
//                it doesn't exist yet).
// pcr_registers: The specific PCR registers to pull from the
//                report and into the new bundle. Optional.
// comments:      Optional comments for the approval.

message AddMeasurementTrustedProfileRequest {
  MeasurementSystemProfileId profile_id = 1;
  MeasurementApprovedTypePb approval_type = 2;
  optional string pcr_registers = 3;
  optional string comments = 4;
}

// AddMeasurementTrustedProfileResponse is returned upon a
// new trusted profile being added.
//
// approval_record: Info about the approval record in
//                  the database.

message AddMeasurementTrustedProfileResponse {
  MeasurementApprovedProfileRecordPb approval_record = 1;
}

// RemoveMeasurementTrustedProfileRequest is used to remove
// a trusted profile approval from the database.
//
// selector: Selects how to remove the approval record, where,
//      approval_id: Remove by approval ID.
//      profile_id: Remove by profile ID.

message RemoveMeasurementTrustedProfileRequest {
  oneof selector {
    MeasurementApprovedProfileId approval_id = 1;
    MeasurementSystemProfileId profile_id = 2;
  }
}

// RemoveMeasurementTrustedProfileResponse is returned upon the
// successful deletion of a trusted profile approval.
//
// approval_record: The full approval record that was deleted.

message RemoveMeasurementTrustedProfileResponse {
  MeasurementApprovedProfileRecordPb approval_record = 1;
}

// ListMeasurementTrustedMachinesRequest lists all trusted
// machine approval records.

message ListMeasurementTrustedMachinesRequest {

}

// ListMeasurementTrustedMachinesResponse contains all trusted
// machine approval records.
//
// approval_records: A list of all trusted machine approval records.

message ListMeasurementTrustedMachinesResponse {
  repeated MeasurementApprovedMachineRecordPb approval_records = 1;
}

// ListMeasurementTrustedProfilesRequest lists all trusted
// profile approval records.

message ListMeasurementTrustedProfilesRequest {

}

// ListMeasurementTrustedProfilesResponse contains all trusted
// profile approval records.
//
// approval_records: A list of all trusted profile approval records.

message ListMeasurementTrustedProfilesResponse {
  repeated MeasurementApprovedProfileRecordPb approval_records = 1;
}

// ImportSiteResult is used for returning back the status
// of a site import request.

enum ImportSiteResult {
  Success = 0;
  Failed = 1;
}

message ListAttestationSummaryRequest {
  
}

message ListAttestationSummaryResponse {
  repeated MachineAttestationSummaryPb attestation_outcomes = 1;
}

message MachineAttestationSummaryPb{
  string machine_id = 1;
  optional MeasurementBundleId bundle_id = 2;
  string profile_name = 3;
  google.protobuf.Timestamp ts = 4;
}

////////////////////////////////////////////////////////////////////////////////
// DTO between Protobuf and DB Models/Records
//
// To make it easier to grep through the codebase, all of
// these will be suffixed with Pb, so we'll have MeasurementBundle
// and MeasurementBundlePb, for example. When I was writing this, I had
// them with the same name, and it was kind of a PITA.
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////
// Bundles

message MeasurementBundlePb {
  MeasurementBundleId bundle_id = 1;
  MeasurementSystemProfileId profile_id = 2;
  string name = 3;
  MeasurementBundleStatePb state = 4;
  repeated MeasurementBundleValueRecordPb values = 5;
  google.protobuf.Timestamp ts = 6;
}

message MeasurementBundleValueRecordPb {
  MeasurementBundleValueId value_id = 1;
  MeasurementBundleId bundle_id = 2;
  int32 pcr_register = 3;
  string sha_any = 4;
  google.protobuf.Timestamp ts = 5;
}

enum MeasurementBundleStatePb {
  Pending = 0;
  Active = 1;
  Obsolete = 2;
  Retired = 3;
  Revoked = 4;
}

message MeasurementBundleRecordPb {
  MeasurementBundleId bundle_id = 1;
  MeasurementSystemProfileId profile_id = 2;
  string name = 3;
  MeasurementBundleStatePb state = 4;
  google.protobuf.Timestamp ts = 5;
}

////////////////////////////////////////
// Journals

message MeasurementJournalPb {
  MeasurementJournalId journal_id = 1;
  string machine_id = 2;
  MeasurementReportId report_id = 3;
  MeasurementSystemProfileId profile_id = 4;
  MeasurementBundleId bundle_id = 5;
  MeasurementMachineStatePb state = 6;
  google.protobuf.Timestamp ts = 7;
}

message MeasurementJournalRecordPb {
  MeasurementJournalId journal_id = 1;
  string machine_id = 2;
  MeasurementReportId report_id = 3;
  MeasurementSystemProfileId profile_id = 4;
  MeasurementBundleId bundle_id = 5;
  MeasurementMachineStatePb state = 6;
  google.protobuf.Timestamp ts = 7;
}

////////////////////////////////////////
// Reports

message MeasurementReportPb {
  MeasurementReportId report_id = 1;
  string machine_id = 2;
  repeated MeasurementReportValueRecordPb values = 3;
  google.protobuf.Timestamp ts = 4;
}

message MeasurementReportValueRecordPb {
  MeasurementReportValueId value_id = 1;
  MeasurementReportId report_id = 2;
  int32 pcr_register = 3;
  string sha_any = 4;
  google.protobuf.Timestamp ts = 5;
}

message MeasurementReportRecordPb {
  MeasurementReportId report_id = 1;
  string machine_id = 2;
  google.protobuf.Timestamp ts = 3;
}

////////////////////////////////////////
// System Profiles

message MeasurementSystemProfilePb {
  MeasurementSystemProfileId profile_id = 1;
  string name = 2;
  google.protobuf.Timestamp ts = 3;
  repeated MeasurementSystemProfileAttrRecordPb attrs = 4;
}

message MeasurementSystemProfileRecordPb {
  MeasurementSystemProfileId profile_id = 1;
  string name = 2;
  google.protobuf.Timestamp ts = 3;
}

message MeasurementSystemProfileAttrRecordPb {
  MeasurementSystemProfileAttrId attribute_id = 1;
  MeasurementSystemProfileId profile_id = 2;
  string key = 3;
  string value = 4;
  google.protobuf.Timestamp ts = 5;
}

////////////////////////////////////////
// Mock Machines

// CandidateMachinePb is bound to the CandidateMachine model
// in model/machine.rs.
message CandidateMachinePb {
  string machine_id = 1;
  map<string, string> attrs = 2;
  MeasurementMachineStatePb state = 3;
  google.protobuf.Timestamp created_ts = 4;
  google.protobuf.Timestamp updated_ts = 5;
  MeasurementJournalPb journal = 6;
}

message CandidateMachineSummaryPb {
  string machine_id = 1;
  google.protobuf.Timestamp ts = 2;
}

message SiteModelPb {
  repeated MeasurementSystemProfileRecordPb measurement_system_profiles = 1;
  repeated MeasurementSystemProfileAttrRecordPb measurement_system_profiles_attrs = 2;
  repeated MeasurementBundleRecordPb measurement_bundles = 3;
  repeated MeasurementBundleValueRecordPb measurement_bundles_values = 4;
}

message MeasurementApprovedMachineRecordPb {
  MeasurementApprovedMachineId approval_id = 1;
  string machine_id = 2;
  MeasurementApprovedTypePb approval_type = 3;
  string pcr_registers = 4;
  string comments = 5;
  google.protobuf.Timestamp ts = 6;
}

message MeasurementApprovedProfileRecordPb {
  MeasurementApprovedProfileId approval_id = 1;
  MeasurementSystemProfileId profile_id = 2;
  MeasurementApprovedTypePb approval_type = 3;
  string pcr_registers = 4;
  string comments = 5;
  google.protobuf.Timestamp ts = 6;
}

enum MeasurementApprovedTypePb {
  Oneshot = 0;
  Persist = 1;
}

message PcrRegisterValuePb {
  int32 pcr_register = 1;
  string sha_any = 2;
}

enum MeasurementMachineStatePb {
  Discovered = 0;
  PendingBundle = 1;
  Measured = 2;
  MeasuringFailed = 3;
}

////////////////////////////////////////////////////////////////////////////////
// Primitives

message KvPair {
  string key = 1;
  string value = 2;
}

// Placeholder ID types: These are not code-generated, but overridden by our own type-safe UUID wrappers. They are
// identical to common.UUID over the wire, for backwards compatibility.
message MeasurementSystemProfileId {
  string value = 1;
}
message MeasurementSystemProfileAttrId {
  string value = 1;
}
message MeasurementBundleId {
  string value = 1;
}
message MeasurementBundleValueId {
  string value = 1;
}
message MeasurementReportId {
  string value = 1;
}
message MeasurementReportValueId {
  string value = 1;
}
message MeasurementJournalId {
  string value = 1;
}
message MeasurementApprovedMachineId {
  string value = 1;
}
message MeasurementApprovedProfileId {
  string value = 1;
}
