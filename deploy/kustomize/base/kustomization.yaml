# SPDX-FileCopyrightText: Copyright (c) 2026 NVIDIA CORPORATION & AFFILIATES. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Kustomize base configuration for Carbide REST services
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: carbide

resources:
  # Namespace
  - namespace.yaml
  
  # CRDs (applied separately in kind-up, but included for reference)
  # - crds/site-crd.yaml
  
  # Infrastructure
  - postgres/statefulset.yaml
  - postgres/service.yaml
  - postgres/init-configmap.yaml
  - postgres/adminer.yaml
  
  # Temporal deployed via Helm chart (see Makefile:kind-reset)
  # Temporal certificates applied separately via temporal-helm kustomization
  # Temporal client certificate (for services in carbide namespace)
  - temporal/temporal-client-cert.yaml
  - keycloak/deployment.yaml
  - keycloak/service.yaml
  - keycloak/realm-configmap.yaml
  
  # Secrets
  - secrets/secrets.yaml
  
  # Database migrations (Job)
  - db/job.yaml
  
  # Application services
  - api/deployment.yaml
  - api/service.yaml
  - api/configmap.yaml
  - workflow/deployment.yaml
  - workflow/configmap.yaml
  - mock-core/deployment.yaml
  - mock-core/service.yaml
  - site-agent/deployment.yaml
  - site-agent/service.yaml
  - site-agent/configmap.yaml
  - site-agent/secret.yaml
  - site-agent/certificate.yaml
  - cert-manager/deployment.yaml
  - cert-manager/service.yaml
  - cert-manager/rbac.yaml
  - site-manager/deployment.yaml
  - site-manager/service.yaml
  - site-manager/rbac.yaml
  - site-manager/certificate.yaml

commonLabels:
  app.kubernetes.io/part-of: carbide-rest

